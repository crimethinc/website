<?xml version='1.0'?>
<urlset xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
        xmlns='http://www.sitemaps.org/schemas/sitemap/0.9'
        xmlns:image='http://www.google.com/schemas/sitemap-image/1.1'
        xmlns:video='http://www.google.com/schemas/sitemap-video/1.1'
        xmlns:news='http://www.google.com/schemas/sitemap-news/0.9'
        xmlns:mobile='http://www.google.com/schemas/sitemap-mobile/1.0'
        xmlns:pagemap='http://www.google.com/schemas/sitemap-pagemap/1.0'
        xmlns:xhtml='http://www.w3.org/1999/xhtml'
        xsi:schemaLocation='http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd'>

  <%= cache @last_modified do %>
    <%# homepage %>
    <%= render 'sitemap/url', loc: root_url, lastmod: @last_modified, changefreq: :daily, priority: 1.0 %>

    <%# default articles feed, for english articles %>
    <%= render 'sitemap/url', loc: feed_url, lastmod: @last_modified, changefreq: :daily, priority: 1.0 %>
  <% end %>

  <%# Atom feeds discovery page, for all languages with articles %>
  <%= render 'sitemap/url', loc: feeds_url, lastmod: @last_modified %>

  <%# articles feed, for all languages with articles %>
  <% @localized_feeds.each do |locale| %>
    <%# Atom feed %>
    <%= render 'sitemap/url', loc: feed_url(locale.abbreviation), lastmod: @last_modified %>

    <%# JSON feed (https://jsonfeed.org) %>
    <%= render 'sitemap/url', loc: json_feed_url(locale.abbreviation), lastmod: @last_modified %>
  <% end %>

  <%# categories %>
  <%= render 'sitemap/url', loc: categories_url, lastmod: @last_modified %>
  <% @categories.each do |category| %>
    <%# category Atom feeds %>
    <%= render 'sitemap/url', loc: category_feed_url(category.slug), lastmod: @last_modified %>
    <%# category JSON feeds %>
    <%= render 'sitemap/url', loc: category_json_feed_url(category.slug), lastmod: @last_modified %>
    <%# category pages %>
    <%= render 'sitemap/url', loc: category_url(category.slug), lastmod: @last_modified %>
  <% end %>

  <%# articles %>
  <% @articles.find_each do |article| %>
    <% cache article do %>
      <%= render 'sitemap/url', loc: [root_url, article.path].join, lastmod: article.updated_at %>
    <% end %>
  <% end %>

  <%# article years %>
  <% @article_years.each do |year| %>
    <% lastmod = DateTime.new(year).end_of_day %>
    <% lastmod = @last_modified if year == Time.current.year %>

    <%= render 'sitemap/url', loc: article_archives_url(year: year), lastmod: lastmod %>
  <% end %>

  <%# @urls.each do |url| %>
    <%#= render 'sitemap/url', loc: url.loc, lastmod: url.lastmod %>
  <%# end %>
</urlset>
